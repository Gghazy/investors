<section class="form-panel">
    <div class="form-header">
        <h2 class="form-title">بيانات المواد الأولية </h2>
        <div>
            <a [routerLink]="'/pages/factory-landing/'+factoryId+'/'+periodId" class="back-link">
                رجوع
                <svg height="25" viewBox="0 0 48 48" width="25" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0 0h48v48h-48z" fill="none"></path>
                    <path d="M40 22h-24.34l11.17-11.17-2.83-2.83-16 16 16 16 2.83-2.83-11.17-11.17h24.34v-4z"
                        style="fill: #666;"></path>
                </svg>
            </a>
        </div>
    </div>
    <div class="form-body">




        <div class="col-md-12 mt-3">
            <h3> إدخال التفاصيل التالية عن المواد الأولية </h3>
        </div>

        <div class="col-md-6 mb-5">
            <label class="form-label"> كم عدد المواد الأولية المستخدمة؟​</label>
            <input type="text" class="form-control" [(ngModel)]="materialCount">
        </div>
        <ul class="list-review factory-lines p-0" *ngFor="let material of data ; let j = index">
        
        <div *ngIf="j+1 <= materialCount">
          
                <li>
                    <h4> المادة رقم {{j+1}}</h4>
                    <div class="row">

                        <div class="col-md-6">
                            <label class="form-label" placement="left" title="" tooltip="شرح الحقل"> اسم البند الجمركي
                                <i>؟</i>
                            </label>
                            <select class="form-select" (change)="onSelectionChange(material,j+1)" [(ngModel)]="material.CustomItemName">
                                <option *ngFor="let item of products" [value]="item.Id">
                                    {{ item.Hs12NameAr }} ({{item. Hs12Code}})
                                
                                </option>
                            </select>
                            <!-- <input type="text" class="form-control" [(ngModel)]="material.CustomItemName" disabled> -->

                        </div>
                        <div class="col-md-3">
                            <label class="form-label" placement="left" title="" tooltip="شرح الحقل"> اسم المادةالأولية
                                <i>؟</i>
                            </label>

                            <input type="text" class="form-control" [(ngModel)]=" material.Name ">

                        </div>
                        <div class="col-md-3">
                            <label class="form-label" placement="left" title="" tooltip="شرح الحقل"> اقصى استهلاك شهريا
                                <i>؟</i>
                            </label>
                            <div class="input-group">
                                <input type="number" class="form-control"
                                    [(ngModel)]="material.MaximumMonthlyConsumption"> 
                                <select class="form-select" (change)="onUnitSelect(material)"
                                    [(ngModel)]="material.UnitId" disabled>
                                    <option *ngFor="let item of units" [value]="item.Id">
                                        {{ item.Name }}
                                    </option>
                                </select>

                               
                            </div>
                        </div>

                        <div class="col-md-3" *ngIf="showKG">
                            <label class="form-label" placement="left" title="" tooltip="شرح الحقل">الوزن المقابل​
                                بالكيلوغرام لكل وحدة
                                <i>؟</i>
                            </label>
                            <div class="input-group">
                                <input type="number" class="form-control" [(ngModel)]="material.AverageWeightKG">
                                <input type="text" class="form-control px-1 text-center" value="كغ" disabled=""
                                    style="max-width: 40px;">
                            </div>
                        </div>


                        <div class="col-md-6">
                            <label class="form-label" placement="left" title="" tooltip="شرح الحقل">تستخدم في أي منتج ؟
                                <i>؟</i>
                            </label>

                            <div class="multiselect-parent">
                                <ng-multiselect-dropdown [placeholder]="'أختر'" [settings]="dropdownSettings"
                                    [data]="products" [(ngModel)]="material.ProductIds"
                                    (onSelect)="onItemSelect($event)" 
                                    (onDeSelect)="onItemDeSelect($event)"
                                    (onSelectAll)="onSelectAll($event)">
                                </ng-multiselect-dropdown>
                            </div>

                        </div>



                        <div class="col-md-3">
                            <label class="form-label" placement="left" title="" tooltip="شرح الحقل">إرفاق صورة المادة
                                الأولية
                                <i>؟</i>
                            </label>
                            <div class="input-group">
                            <input type="file" class="form-control" placeholder="" [(ngModel)]="material.PhotoId"
                                (change)="savePhoto($event,j)"> 
                                <!-- <a href="" class="btn btn-danger px-2 py-1" placement="right" title=""
                                tooltip=" حذف صورة المادة" (click)="deleteFile(material.PhotoId)"><i class="icon-delete"></i></a> -->
                            </div>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label" placement="left" title=""
                                tooltip="إرفاق ورقة البيانات أو دليل/ معايير البيانات إن وجدت"
                                aria-describedby="tooltip617728"> إرفاق ورقة
                                البيانات <i>؟</i></label>
                                <div class="input-group">
                            <input type="file" class="form-control" placeholder="" value=""
                                (change)="savePaper($event,j)">
                                <!-- <a href="" class="btn btn-danger px-2 py-1" placement="right" title=""
                                tooltip=" حذف صورة المادة" (click)="deleteFile(material.paper)"><i class="icon-delete"></i></a> -->
                            </div>
                        </div>
                    
                        <div class="col-md-12">
                            <label class="form-label" placement="left" title="" tooltip="شرح الحقل">وصف للمادة المستخدمة
                                <i>؟</i>
                            </label>

                            <textarea class="form-control" rows="2" [(ngModel)]="material.Description"></textarea>

                        </div>




                    </div>
                </li>


            </div>

        </ul>
   
        <app-pagination (changePage)="pageChanged($event)" [pageSize]="materials.PageSize"
            [pageNumber]="materials.PageNumber" [totalCount]="materials.TotalCount"></app-pagination>

        <div class="row">
            <div class="col-md-6">
                <label class="form-label">هل لديك مواد أولية جديدة تريد إضافتها؟</label>
                <select class="form-select if-yes" (change)="handleSelectChange($event)">
                    <option value="yes">نعم</option>
                    <option value="no" selected>لا</option>
                </select>
            </div>
            <div class="col-md-4 show-input" [ngClass]="{'d-none': !showInput}">
                <label class="form-label"> إضافة مادة أولية جديد</label>
                <div class="form-group">
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addRawMaterial">إضافة مادة
                        أولية</button>
                </div>
            </div>
        </div>


    </div>

    <!-- Modal photos-->
    <div class="modal fade" id="photoModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"> صورة المادة الأولية</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <img src="{{src}}" alt="" class="img-fluid">
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Add Raw Material-->
    <div class="modal fade" id="addRawMaterial" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"> إضافة مادة أولية</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                        #closeModal></button>
                </div>
                <div class="modal-body">




                    <app-factory-raw-materials-form [factoryId]="factoryId"
                        (close)="closePopUp()"></app-factory-raw-materials-form>
                </div>
            </div>
        </div>
    </div>

    <div class="form-footer">
        <div class="col-12">
            <button class="btn btn-primary me-1" type="submit" (click)="save()">حفظ</button>
            <a [routerLink]="'/pages/factory-landing/'+factoryId" class="btn btn-danger">الغاء</a>
        </div>
    </div>
</section>