<section class="form-panel">
    <div class="form-header">
        <h2 class="form-title"> موقع المصنع لشهر {{PeriodName}}  -عام  {{year}} </h2>
        <div>
            <a [routerLink]="'/pages/factory-landing'" class="back-link">
                رجوع
                <svg height="25" viewBox="0 0 48 48" width="25" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0 0h48v48h-48z" fill="none"></path>
                    <path d="M40 22h-24.34l11.17-11.17-2.83-2.83-16 16 16 16 2.83-2.83-11.17-11.17h24.34v-4z"
                        style="fill: #666;"></path>
                </svg>
            </a>
        </div>
    </div>
    <div class="form-body">           
        <div class="mb-4 alert alert-fui  alert-dismissible fade show" role="alert">
            <P>
            في حال كان المصنع خارج نطاق اي منطقة صناعية ، يتم تحديد خيار (أخرى) في كل من قائمة الجهة التي يتبع لها المصنع 
            وقائمة المدينة ومن ثم اختيار خيار (خارج نطاق المدن الصناعية ) من قائمة المنطقة الصناعية.    
            </div>
            <form [formGroup]="factoryLocForm">        
                <div class="row">
                <div class="col-md-6" for="factoryEntityId">
                <label class="form-label"> الجهة التي يتبع لها المصنع​<span class="required">*</span></label>
              
                <select class="form-select"  
               #FactoryEntityId  name="FactoryEntityId" [(ngModel)]="request.FactoryEntityId" id="factoryEntityId"
                 (change)="onEntitySelect(request.FactoryEntityId)" formControlName="factoryEntityId" required>
                    <option *ngFor="let factoryEntity of factoryEntities" [ngValue]="factoryEntity.Id">
                        {{factoryEntity.NameAr}} </option>
                </select>
                <span  class="text-danger" *ngIf="submitted && !request.FactoryEntityId">
                    الرجاء إختيار الجهة التي يتبع لها المصنع 
                  </span>
                 
            </div>

            <div class="col-md-6" >
                <label class="form-label"> المدينة<span class="required">*</span></label>
                <select class="form-select"   
                name="CityId" [(ngModel)]="request.CityId"
                 (change)="onCitySelect(request.CityId)" formControlName="cityId"  >
                    <option *ngFor="let city of cities" [ngValue]="city.Id">{{city.NameAr}} </option>

                </select>
                <span  class="text-danger" *ngIf="submitted && !request.CityId">
                    الرجاء إختيار المدينة
                  </span>
                
            </div>
        </div>
       
        <div class="row">
            <div class="col-md-6" for="industrialAreaId">
                <label class="form-label"> المنطقة الصناعية<span class="required">*</span></label>
                <select class="form-select" name="IndustrialAreaId"  formControlName="industrialAreaId"  id="industrialAreaId"
                [(ngModel)]="request.IndustrialAreaId" >
                    <option *ngFor="let industrialArea of industrialAreas" [ngValue]="industrialArea.Id" >{{industrialArea.NameAr}} </option>
                </select>
                <span  class="text-danger" *ngIf="submitted && !request.IndustrialAreaId">
                    الرجاء إختيار المنطقة الصناعية          
                        </span>
                
            </div>

            <div class="col-md-6">
               
                <label class="form-label" placement="left" title="" tooltip="اضغط على الموقع لعرضه في الخريطة أو لإختيار موقع جديد ">  
                     موقع المصنع <span  class="file-size-span"> اضغط في الموقع لإختياره أوعرضه على الخريطة
                </span> 
                    <span class="required">*</span>
                    <i>؟</i>
                </label>
                <input type="text"  id="webSiteUrl" formControlName="webSiteUrl" name="WebSite" 
                class="form-control btn-primary" data-bs-toggle="modal" data-bs-target="#mapModal" 
                 [(ngModel)]="SelectedLocation"  placeholder="إضغط هنا لإختيار الموقع">
              <!-- Button to trigger the modal -->

  
  <!-- Modal structure -->
  <div class="modal fade" id="mapModal" tabindex="-1" aria-labelledby="mapModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="mapModalLabel">خريطة المملكة العربية السعودية</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            
            <div #mapContainer class="map-container" ></div>
            
            
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
          <button type="button"  (click)="selectLocation()" data-bs-dismiss="modal" class="btn btn-primary">حفظ</button>
        </div>
      </div>
    </div>
  </div>  
  <span  class="text-danger" *ngIf="submitted && SelectedLocation==''">

الرجاء  إختيار موقع المصنع 

</span>
                
                <!--<input type="url" id="webSiteUrl"  formControlName="webSiteUrl" name="WebSite"   class="form-control " [(ngModel)]="request.WebSite" placeholder="https://www.google.com/maps"    >
                <span  class="text-danger" *ngIf="submitted && (factoryLocForm.get('webSiteUrl')?.errors?.['pattern'] || factoryLocForm.get('webSiteUrl')?.errors?.['required'])">

                    رابط موقع المصنع يبدأ ب https://www.google.com/maps <br>
                     أو  /https://maps.app.goo.gl 

                </span>-->
               
                   
            </div>
           


        </div>

        <app-location-file   [factoryLocationId]="request.Id"
         (fileStatusLoc)="getFilestatus($event)"
         (DeletedfileIds)="DeleteFiles($event)"
         (AddedfileIds)="AddFiles($event)"
         ></app-location-file>

    
    <div class="form-footer">
        <div class="col-12">
            <button class="btn btn-primary me-1"[disabled]="approveStatus" (click)="save()"  type="button">حفظ</button>

            <button type="button" (click)="cancel()" class="btn btn-danger">الغاء</button>
        </div>
    </div>
</form>
    </div>
</section>


